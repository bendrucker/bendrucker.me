name = "bendrucker-me"
main = "./dist/_worker.js/index.js"
compatibility_date = "2025-07-28"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "dist"
binding = "ASSETS"

# Shared KV namespace for both main site and GitHub activity worker
[[kv_namespaces]]
binding = "ACTIVITY_KV"
namespace_name = "github"
preview_namespace_name = "github-preview"

[[routes]]
pattern = "www.bendrucker.me"
custom_domain = true

[observability.logs]
enabled = true

# GitHub Activity Worker Configuration (separate worker for cron jobs)
[env.github-activity]
name = "github-activity-worker"
main = "workers/github-activity.ts"

[[env.github-activity.kv_namespaces]]
binding = "ACTIVITY_KV"
namespace_name = "github"
preview_namespace_name = "github-preview"

# GitHub token should be set via: wrangler secret put GITHUB_TOKEN --env github-activity
# [env.github-activity.vars]
# GITHUB_TOKEN = "configured-via-secrets"

# Cron trigger to update activity data every 6 hours
[[env.github-activity.triggers.crons]]
cron = "0 */6 * * *"
