---
// Debug page to test KV access - access through Astro.locals.runtime.env
const { GITHUB_KV } = Astro.locals.runtime.env;

let result = '';
try {
  if (!GITHUB_KV) {
    result = 'GITHUB_KV binding is not available';
  } else {
    const data = await GITHUB_KV.get('activity');
    if (data) {
      const parsed = JSON.parse(data);
      result = `Found ${parsed.length} repositories in KV`;
    } else {
      result = 'KV binding exists but no activity data found';
    }
  }
} catch (error) {
  result = `Error: ${error instanceof Error ? error.message : 'Unknown error'}`;
}
---

<html>
<head><title>KV Debug</title></head>
<body>
  <h1>KV Debug</h1>
  <p>{result}</p>
</body>
</html>
